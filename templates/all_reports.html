{% extends "layout.html" %}
{% block content %}

<h2 style="margin-bottom:20px;">כל התקלות במערכת</h2>

<div style="margin-bottom:20px;">
    <strong>סינון:</strong>
    <a href="/all_reports">הכול</a> &nbsp;|&nbsp;
<a href="/all_reports?status=received">תקלות פתוחות</a> &nbsp;|&nbsp;
<a href="/all_reports?status=in_progress">תקלות בטיפול</a> &nbsp;|&nbsp;
<a href="/all_reports?status=done">תקלות שטופלו</a> 
</div>

<table class="table">
    <thead>
        <tr>
            <th>מספר</th>
            <th>דירה</th>
            <th>תאריך</th>
            <th>חדר</th>
            <th>קטגוריה</th>
            <th>תיאור</th>
            <th>עדיפות</th>
            <th>סטטוס</th>
        </tr>
    </thead>
    <tbody>
        {% for r in reports %}
        <tr>
            <td>{{ r.id }}</td>
            <td>{{ r.apartment_id }}</td>
            <td>{{ r.created_at }}</td>
            <td>{{ r.room }}</td>
            <td>{{ r.issue_type }}</td>
            <td>{{ r.description }}</td>
            <td>{{ r.priority }}</td>
            <td>
                <form action="/report/{{ r.id }}/status" method="POST" style="display:flex; gap:6px;">
                    <select name="status">
                        <option value="received"     {% if r.status == 'received' %}selected{% endif %}>התקבל</option>
                        <option value="in_progress"  {% if r.status == 'in_progress' %}selected{% endif %}>בטיפול</option>
                        <option value="done"         {% if r.status == 'done' %}selected{% endif %}>טופל</option>
                    </select>

                    <button type="submit">שמור</button>
                </form>
            </td>

        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
